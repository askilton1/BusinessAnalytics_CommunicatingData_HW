---
title: "Technical Appendix"
author: "Antonio Skilton"
date: "September 16, 2016"
output: pdf_document
---

## Data Import
The dataset contains 5 variables and 200 observations detailing the advertising spending and sales revenue of a product in each market. The "TV", "Radio", and "Newspaper" columns represent advertising spending in thousands of dollars, "Sales" represents sales revenue in millions of dollars, and "Market" specifies whether the market advertised and sold in was "Urban", "Rural", or "SubUrban".

I have also added "AdSpending", which is simply the sum of "TV", "Radio", and "Newspaper".
```{r, message=FALSE}
library(dplyr)
AdData <- read.csv("1_FDA_AdData.csv") %>%
  mutate(Sales = Sales * 1000,AdSpending = rowSums(.[1:3]))
```

```{r,results='asis',message=FALSE,echo=FALSE}
library(knitr)
kable(AdData[1:20,],caption="First 20 rows of Advertising data",align='c')
```

\newpage

## Summary Statistics
```{r,message=FALSE}
library(psych)
sumStats <- describe(select(AdData,-Market),skew=FALSE)[,c(-1,-2,-8)]
kable(sumStats,digits=2,caption="Summary Statistics",align='c')
```

```{r,message=FALSE,results='asis',fig.align='center',echo=FALSE}
AdData <- mutate(AdData,row_number=1:n())
library(reshape2)
AdData.melt <- melt(AdData,id=c("row_number","Market","Sales"))
library(ggplot2)
ggplot(filter(AdData.melt,variable!="AdSpending"),aes(x=Market,y=value,color=variable,alpha=0.75)) +
  geom_boxplot() + 
  theme(legend.position="bottom",legend.title=element_blank()) + 
  ggtitle("Figure 1: Distribution of Advertising Spending by \nMarket and Advertising Medium") + 
  ylab("Advertising Spending (in $1M)") + 
  scale_alpha(guide="none")
AdData <- select(AdData,-row_number)
```

\newpage

Histograms and total advertising spending per individual store by Market, in thousands of dollars below. It is clear that advertising spending is correlated with sales. Due to the categorical differences between markets however, we cannot assume any causative relationships

```{r, message=FALSE, warning=FALSE,fig.align='center',fig.height=3,echo=FALSE}
library(ggplot2)
plot_Sales <- ggplot(AdData,aes(x=Sales,fill=Market)) + 
  geom_histogram(position="dodge") + facet_grid(Market~.) + 
  theme(legend.position="none",strip.text.y=element_blank())
plot_Adspending <- ggplot(AdData,aes(x=AdSpending,fill=Market)) + 
  geom_histogram(position="dodge") + 
  facet_grid(Market~.) + 
  theme(legend.position="none",axis.title.y=element_blank(),
        axis.text.y=element_blank(),axis.ticks.y=element_blank()) + 
  scale_y_continuous(limits=c(0,15))
library(gridExtra)
grid.arrange(plot_Sales,plot_Adspending,ncol=2)
```

The same correlation is perhaps better visualized using a dotplot:
```{r,fig.height=4,echo=FALSE,fig.align='center'}
ggplot(AdData,aes(x=AdSpending,y=Sales,color=Market,alpha=0.75)) + 
  geom_point() + 
  scale_alpha(guide="none")
```

\newpage

## Discovering Trends
We use the reshape2 package in order to reshape the data; each observation in the new dataset represents a unique combination of store and type of advertising. The resulting data frame is plotted by the ggplot2 package, which facets the data by both type of market and type of advertising spending. Each dot represents an individual observation as described, while the lines are trendlines that include 95% confidence interval boundaries.

```{r pressure, echo=T,message=FALSE,fig.align='center',echo=FALSE}
library(ggplot2)
ggplot(AdData.melt,aes(x=value,y=Sales/1000,color=Market,alpha=0.75)) + 
  geom_point() + 
  theme(legend.position="none") + 
  stat_smooth() + 
  facet_grid(Market~variable,scales="free") + 
  ggtitle("Sales by Advertising Spending") + 
  ylab("Sales (in $1M)") + 
  xlab("Advertising Spending (in $1K)")
```

In the above plot we see clear positive correlations for TV advertising in the Rural and Suburban markets, and Radio advertising spending in the Urban market. Several of the plots, such as the bottom right plot depicting the relationship between Newspaper advertising and spending and Sales in Urban Markets, contain outliers that obfuscate what might otherwise be clear trends.

\newpage

## Linear Models
In order to determine how to most efficiently allocate advertising spending, we use linear regression to find the model that most accurately predicts sales. Note that television ad spending has an exponential relationship with sales in Rural markets.


```{r, message=FALSE, warning=FALSE}
Rural.mod <- lm(Sales~TV+I(TV^2)+Radio+Newspaper,data=AdData[AdData$Market=="Rural",-5])
Urban.mod <- lm(Sales~TV+Radio+Newspaper,data=AdData[AdData$Market=="Urban",-5])
SubUrban.mod <- lm(Sales~TV+Radio+Newspaper,data=AdData[AdData$Market=="SubUrban",-5])
```

```{r,results='asis', message=FALSE,echo=FALSE}
library(stargazer)
stargazer(Rural.mod,Urban.mod,SubUrban.mod,
          covariate.labels=c("TV","TV*TV","Radio","Newspaper"),
          column.labels=c("Rural","Urban","SubUrban"),
no.space=TRUE,header=FALSE,keep.stat=c("n","adj.rsq"),title="Linear Models by Market",model.numbers=FALSE)
```

